<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>完整动态数据可视化平台</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        /* 样式保持不变，与您提供的完全一致 */
        body {
            margin: 0;
            padding: 0;
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #1890ff;
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
        }
        
        .nav-tabs {
            display: flex;
            background: #fafafa;
            border-bottom: 1px solid #e8e8e8;
            overflow-x: auto;
            padding: 0 20px;
        }
        
        .nav-tab {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .nav-tab:hover {
            background: #e6f7ff;
        }
        
        .nav-tab.active {
            color: #1890ff;
            border-bottom: 3px solid #1890ff;
            background: white;
        }
        
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .chart-page {
            display: none;
        }
        
        .chart-page.active {
            display: block;
        }
        
        .chart-container {
            height: 500px;
            margin: 20px 0;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 20px;
            background: #fafafa;
        }
        
        .chart-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            text-align: center;
        }
        
        .chart-wrapper {
            height: 420px;
            width: 100%;
        }
        
        .chart-description {
            margin: 20px 0;
            padding: 15px;
            background: #e6f7ff;
            border-radius: 6px;
            border-left: 4px solid #1890ff;
        }
        
        .chart-description h3 {
            margin-top: 0;
            color: #1890ff;
        }
        
        .chart-actions {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
        }
        
        .action-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 15px;
            margin-left: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-button:hover {
            background: #40a9ff;
        }
        
        .data-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .data-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 1px solid #e8e8e8;
            padding-bottom: 10px;
        }
        
        .data-api {
            margin-bottom: 20px;
        }
        
        .api-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #1890ff;
        }
        
        .api-code {
            background: #f1f1f1;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin-bottom: 5px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .data-table th {
            background: #f1f1f1;
            font-weight: bold;
        }
        
        .data-table tr:hover {
            background: #f5f5f5;
        }
        
        .data-input-section {
            margin-top: 20px;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 1px dashed #1890ff;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .input-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .submit-button {
            background: #52c41a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .submit-button:hover {
            background: #73d13d;
        }
        
        .excel-upload {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #d9d9d9;
        }
        
        .excel-format {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }
        
        .excel-format ul {
            padding-left: 20px;
            margin-top: 5px;
        }
        
        .chart-switch-container {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .chart-switch-button {
            background: #f0f0f0;
            color: #333;
            border: 1px solid #d9d9d9;
            padding: 6px 12px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .chart-switch-button:hover {
            background: #e6e6e6;
        }
        
        .chart-switch-button.active {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #52c41a;
            color: white;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transform: translateX(150%);
            transition: transform 0.3s ease-out;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: #ff4d4f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>完整动态数据可视化平台</h1>
            <p>支持11种图表类型的实时数据接入和动态更新</p>
        </div>
        
        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="line-chart">折线图</div>
            <div class="nav-tab" data-tab="bar-chart">柱状图</div>
            <div class="nav-tab" data-tab="horizontal-bar-chart">水平柱状图</div>
            <div class="nav-tab" data-tab="area-chart">堆积图</div>
            <div class="nav-tab" data-tab="histogram-chart">直方图</div>
            <div class="nav-tab" data-tab="pie-donut-chart">饼图/环形图</div>
            <div class="nav-tab" data-tab="scatter-chart">散点图</div>
            <div class="nav-tab" data-tab="error-chart">箱线图</div>
            <div class="nav-tab" data-tab="radar-chart">雷达图</div>
            <div class="nav-tab" data-tab="error-bar-chart">误差棒图</div>
        </div>
        
        <div class="content">
            <!-- 页面1: 折线图 -->
            <div class="chart-page active" id="line-chart">
                <div class="chart-container">
                    <div class="chart-title">最高最低温度折线图</div>
                    <div class="chart-actions">
                        <button class="action-button" onclick="exportChart('line-chart')">导出图表</button>
                        <button class="action-button" onclick="refreshChart('line-chart')">刷新数据</button>
                    </div>
                    <div id="line-chart-wrapper" class="chart-wrapper"></div>
                </div>
                
                <div class="chart-description">
                    <h3>图表介绍</h3>
                    <p>此折线图展示了4月到18日期间的最高温度和最低温度变化趋势。通过双线对比，可以清晰地观察到每日温差变化，帮助分析气温波动规律。您可以通过下方的数据接口输入新的温度数据，系统将自动更新图表。</p>
                </div>
                
                <div class="data-section">
                    <div class="data-title">数据接口</div>
                    <div class="data-api">
                        <div class="api-title">API端点</div>
                        <div class="api-code">POST /api/temperature-data</div>
                        <div class="api-title">请求参数</div>
                        <div class="api-code">{
  "dates": ["4", "5", "6", "7"],
  "maxTemps": [32, 33, 34, 34],
  "minTemps": [19, 19, 20, 22]
}</div>
                        <div class="api-title">返回格式</div>
                        <div class="api-code">{
  "success": true,
  "message": "数据已更新"
}</div>
                    </div>
                    
                    <div class="data-input-section">
                        <div class="data-title">输入新数据</div>
                        <div class="input-group">
                            <label for="line-dates">日期 (用逗号分隔)</label>
                            <input type="text" id="line-dates" placeholder="例如: 4,5,6,7">
                        </div>
                        <div class="input-group">
                            <label for="line-max-temps">最高温度 (用逗号分隔)</label>
                            <input type="text" id="line-max-temps" placeholder="例如: 32,33,34,34">
                        </div>
                        <div class="input-group">
                            <label for="line-min-temps">最低温度 (用逗号分隔)</label>
                            <input type="text" id="line-min-temps" placeholder="例如: 19,19,20,22">
                        </div>
                        <button class="submit-button" onclick="submitLineData()">提交数据</button>
                        
                        <div class="excel-upload">
                            <div class="data-title">或导入Excel文件</div>
                            <div class="input-group">
                                <label for="line-excel-file">选择Excel文件</label>
                                <input type="file" id="line-excel-file" accept=".xlsx,.xls" onchange="handleLineExcelFile(this)">
                            </div>
                            <div class="excel-format">
                                <p>Excel文件格式要求：</p>
                                <ul>
                                    <li>第一列：日期</li>
                                    <li>第二列：最高温度</li>
                                    <li>第三列：最低温度</li>
                                    <li>第一行为标题行（可选）</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 其他页面保持不变 -->
            <!-- 页面2-11的HTML结构与您提供的完全一致 -->
        </div>
    </div>
    
    <div class="notification" id="notification"></div>

    <script>
        // 全局数据存储 - 保持不变
        let chartData = {
            line: {
                dates: ['4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18'],
                maxTemps: [32, 33, 34, 34, 33, 31, 30, 29, 30, 29, 26, 23, 21, 25, 31],
                minTemps: [19, 19, 20, 22, 22, 21, 22, 16, 18, 18, 17, 14, 15, 16, 16]
            },
            bar: {
                years: ['FY2013', 'FY2014', 'FY2015', 'FY2016', 'FY2017', 'FY2018', 'FY2019'],
                values: [10770, 16780, 24440, 30920, 37670, 48200, 57270]
            },
            horizontalBar: {
                categories: ['家政、家教、保姆等生活服务', '飞机票、火车票', '家具', '手机、手机配件', '计算机及其配套产品', '汽车用品', '通信充值、游戏充值', '个人护理用品', '书报杂志及音像制品', '餐饮、旅游、住宿', '家用电器', '食品、饮料、烟酒、保健品', '家庭日杂用品', '保险、演出票务', '服装、鞋帽、家用纺织品', '数码产品', '其他商品和服务', '工艺品、收藏品'],
                rates: [0.959, 0.951, 0.935, 0.924, 0.893, 0.892, 0.865, 0.863, 0.860, 0.856, 0.854, 0.835, 0.826, 0.816, 0.798, 0.765, 0.763, 0.670]
            },
            area: {
                months: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],
                companyA: [198, 215, 245, 222, 200, 236, 201, 253, 236, 200, 266, 290],
                companyB: [203, 236, 200, 236, 269, 216, 298, 333, 301, 349, 360, 368],
                companyC: [185, 205, 226, 199, 238, 200, 250, 209, 246, 219, 253, 288]
            },
            histogram: {
                ranges: ['0-10', '10-20', '20-30', '30-40', '40-50', '50-60', '60-70', '70-80', '80-90', '90-100'],
                frequencies: [5, 12, 25, 35, 28, 20, 15, 10, 6, 3]
            },
            pie: {
                sources: [
                    { name: '直接访问', value: 335 },
                    { name: '邮件营销', value: 310 },
                    { name: '联盟广告', value: 234 },
                    { name: '视频广告', value: 135 },
                    { name: '搜索引擎', value: 1548 }
                ]
            },
            donut: {
                categories: [
                    { name: '电子产品', value: 350 },
                    { name: '家居用品', value: 250 },
                    { name: '服装鞋帽', value: 200 },
                    { name: '食品饮料', value: 120 },
                    { name: '其他', value: 80 }
                ]
            },
            scatter: {
                data: []
            },
            error: {
                data2017: [4605.2, 4710.3, 5168.9, 4767.2, 4947, 5203, 6047.4, 5945.5, 5219.6, 5038.1, 5196.3, 5698.6],
                data2018: [5200, 5254.5, 5283.4, 5107.8, 5443.3, 5550.6, 6400.2, 6404.9, 5483.1, 5330.2, 5543, 6199.9]
            },
            radar: {
                personal: [85, 70, 60, 75, 80, 65],
                average: [65, 65, 65, 65, 65, 65]
            },
            errorBar: {
                categories: ['条件A', '条件B', '条件C', '条件D', '条件E'],
                values: [25.3, 32.7, 41.5, 38.2, 29.6],
                errors: [1.2, 2.1, 3.4, 2.8, 1.9]
            }
        };
        
        // 初始化散点图数据
        for (let i = 0; i < 100; i++) {
            chartData.scatter.data.push({
                x: Math.round(Math.random() * 100),
                y: Math.round(Math.random() * 100)
            });
        }
        
        // Excel文件处理函数
        function processExcelFile(file, callback) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // 获取第一个工作表
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    
                    // 将工作表转换为JSON
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    callback(jsonData);
                } catch (error) {
                    showNotification('Excel文件处理失败: ' + error.message, true);
                }
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // 通用Excel数据处理函数
        function processExcelData(jsonData, chartType, updateCallback) {
            try {
                // 跳过标题行（如果有）
                let startIndex = 0;
                if (jsonData.length > 0) {
                    // 根据不同图表类型判断是否需要跳过标题行
                    switch(chartType) {
                        case 'line':
                            startIndex = isNaN(parseFloat(jsonData[0][1])) ? 1 : 0;
                            break;
                        case 'bar':
                            startIndex = isNaN(parseFloat(jsonData[0][1])) ? 1 : 0;
                            break;
                        case 'horizontalBar':
                            startIndex = isNaN(parseFloat(jsonData[0][1])) ? 1 : 0;
                            break;
                        case 'area':
                            startIndex = isNaN(parseFloat(jsonData[0][1])) ? 1 : 0;
                            break;
                        case 'histogram':
                            startIndex = isNaN(parseFloat(jsonData[0][1])) ? 1 : 0;
                            break;
                        case 'pie':
                            startIndex = isNaN(parseFloat(jsonData[0][1])) ? 1 : 0;
                            break;
                        case 'scatter':
                            startIndex = isNaN(parseFloat(jsonData[0][0])) ? 1 : 0;
                            break;
                        case 'error':
                            startIndex = isNaN(parseFloat(jsonData[0][0])) ? 1 : 0;
                            break;
                        case 'radar':
                            startIndex = isNaN(parseFloat(jsonData[0][0])) ? 1 : 0;
                            break;
                        case 'errorBar':
                            startIndex = isNaN(parseFloat(jsonData[0][1])) ? 1 : 0;
                            break;
                        default:
                            startIndex = 0;
                    }
                }
                
                // 处理数据
                const processedData = [];
                for (let i = startIndex; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (row.length > 0 && row.some(cell => cell !== undefined && cell !== null && cell !== '')) {
                        processedData.push(row);
                    }
                }
                
                if (processedData.length === 0) {
                    showNotification('Excel文件中没有有效数据', true);
                    return;
                }
                
                // 调用回调函数更新图表数据
                updateCallback(processedData);
                
                return true;
            } catch (error) {
                showNotification('Excel文件格式错误: ' + error.message, true);
                return false;
            }
        }
        
        // 初始化所有图表
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM加载完成，初始化图表...');
            
            // 标签页切换功能
            const tabs = document.querySelectorAll('.nav-tab');
            const pages = document.querySelectorAll('.chart-page');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-tab');
                    console.log('切换到标签:', targetId);
                    
                    // 移除所有活动状态
                    tabs.forEach(t => t.classList.remove('active'));
                    pages.forEach(p => p.classList.remove('active'));
                    
                    // 添加当前活动状态
                    this.classList.add('active');
                    document.getElementById(targetId).classList.add('active');
                    
                    // 渲染当前页面的图表
                    renderChart(targetId);
                });
            });
            
            // 初始渲染第一个图表
            setTimeout(function() {
                console.log('初始渲染折线图');
                renderChart('line-chart');
            }, 100);
            
            // 响应式调整
            window.addEventListener('resize', function() {
                const activePage = document.querySelector('.chart-page.active');
                if (activePage) {
                    resizeChart(activePage.id);
                }
            });
        });
        
        // 渲染指定图表
        function renderChart(chartId) {
            console.log('渲染图表:', chartId);
            switch(chartId) {
                case 'line-chart':
                    renderLineChart();
                    break;
                case 'bar-chart':
                    renderBarChart();
                    break;
                case 'horizontal-bar-chart':
                    renderHorizontalBarChart();
                    break;
                case 'area-chart':
                    renderAreaChart();
                    break;
                case 'histogram-chart':
                    renderHistogramChart();
                    break;
                case 'pie-donut-chart':
                    renderPieDonutChart();
                    break;
                case 'scatter-chart':
                    renderScatterChart();
                    break;
                case 'error-chart':
                    renderBoxplotChart();
                    break;
                case 'radar-chart':
                    renderRadarChart();
                    break;
                case 'error-bar-chart':
                    renderErrorBarChart();
                    break;
            }
        }
        
        // 调整指定图表大小
        function resizeChart(chartId) {
            switch(chartId) {
                case 'line-chart':
                    if (window.lineChartInstance) window.lineChartInstance.resize();
                    break;
                case 'bar-chart':
                    if (window.barChartInstance) window.barChartInstance.resize();
                    break;
                case 'horizontal-bar-chart':
                    if (window.horizontalBarChartInstance) window.horizontalBarChartInstance.resize();
                    break;
                case 'area-chart':
                    if (window.areaChartInstance) window.areaChartInstance.resize();
                    break;
                case 'histogram-chart':
                    if (window.histogramChartInstance) window.histogramChartInstance.resize();
                    break;
                case 'pie-donut-chart':
                    if (window.pieDonutChartInstance) window.pieDonutChartInstance.resize();
                    break;
                case 'scatter-chart':
                    if (window.scatterChartInstance) window.scatterChartInstance.resize();
                    break;
                case 'error-chart':
                    if (window.boxplotChartInstance) window.boxplotChartInstance.resize();
                    break;
                case 'radar-chart':
                    if (window.radarChartInstance) window.radarChartInstance.resize();
                    break;
                case 'error-bar-chart':
                    if (window.errorBarChartInstance) window.errorBarChartInstance.resize();
                    break;
            }
        }
        
        // 1. 折线图
        function renderLineChart() {
            const chartDom = document.getElementById('line-chart-wrapper');
            if (!chartDom) {
                console.error('Line chart container not found');
                return;
            }
            
            if (window.lineChartInstance) {
                window.lineChartInstance.dispose();
            }
            
            window.lineChartInstance = echarts.init(chartDom);
            const option = {
                title: {
                    text: '4月-18日最高最低温度',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: ['最高温度', '最低温度'],
                    top: 30
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: chartData.line.dates
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '{value} °C'
                    }
                },
                series: [
                    {
                        name: '最高温度',
                        type: 'line',
                        data: chartData.line.maxTemps,
                        itemStyle: {
                            color: '#ff7f0e'
                        }
                    },
                    {
                        name: '最低温度',
                        type: 'line',
                        data: chartData.line.minTemps,
                        itemStyle: {
                            color: '#1f77b4'
                        }
                    }
                ]
            };
            window.lineChartInstance.setOption(option);
            
            // 确保图表正确渲染
            setTimeout(() => {
                window.lineChartInstance.resize();
            }, 100);
        }
        
        // 其他图表渲染函数保持不变...
        // 2. 柱状图
        function renderBarChart() {
            const chartDom = document.getElementById('bar-chart-wrapper');
            if (!chartDom) {
                console.error('Bar chart container not found');
                return;
            }
            
            if (window.barChartInstance) {
                window.barChartInstance.dispose();
            }
            
            window.barChartInstance = echarts.init(chartDom);
            const option = {
                title: {
                    text: '淘宝天猫GMV',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: chartData.bar.years
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '{value} 亿元'
                    }
                },
                series: [
                    {
                        name: 'GMV',
                        type: 'bar',
                        data: chartData.bar.values,
                        itemStyle: {
                            color: '#2ca02c'
                        }
                    }
                ]
            };
            window.barChartInstance.setOption(option);
            
            setTimeout(() => {
                window.barChartInstance.resize();
            }, 100);
        }
        
        // 3. 水平柱状图
        function renderHorizontalBarChart() {
            const chartDom = document.getElementById('horizontal-bar-chart-wrapper');
            if (!chartDom) return;
            
            if (window.horizontalBarChartInstance) {
                window.horizontalBarChartInstance.dispose();
            }
            
            window.horizontalBarChartInstance = echarts.init(chartDom);
            const option = {
                title: {
                    text: '线上替代率',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: '{value}'
                    }
                },
                yAxis: {
                    type: 'category',
                    data: chartData.horizontalBar.categories
                },
                series: [
                    {
                        name: '替代率',
                        type: 'bar',
                        data: chartData.horizontalBar.rates,
                        itemStyle: {
                            color: '#d62728'
                        }
                    }
                ]
            };
            window.horizontalBarChartInstance.setOption(option);
        }
        
        // 其他图表函数保持不变...
        
        // 显示通知
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification show';
            if (isError) {
                notification.classList.add('error');
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // 其他函数保持不变...
    </script>
</body>
</html>
